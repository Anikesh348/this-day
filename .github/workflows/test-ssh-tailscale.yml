name: Test SSH to Pi over Tailscale

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: üß© Join Tailscale tailnet
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
          hostname: gha-test-thisday

      - name: üîç Verify Tailscale status
        run: |
          echo "== Tailscale status =="
          tailscale status
          echo ""
          echo "== Tailscale IPs =="
          tailscale ip

      - name: üîê SSH into Raspberry Pi
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.PI_HOST }}
          username: ${{ secrets.PI_USER }}
          key: ${{ secrets.PI_SSH_KEY }}
          script: |
            echo "‚úÖ SSH connection successful"
            echo "Hostname:"
            hostname
            echo "User:"
            whoami
            echo "Uptime:"
            uptime
            echo "Disk usage:"
            df -h /
